{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Evergreen Computers</title>

  <!-- CSRF Token -->
  <meta name="csrf-token" content="{{ csrf_token }}">

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">

  <!-- IonIcons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">


  <!-- DataTables -->
  <link rel="stylesheet" href="{% static 'plugins/datatables-bs4/css/dataTables.bootstrap4.min.css'%}">
  <link rel="stylesheet" href="{% static 'plugins/datatables-responsive/css/responsive.bootstrap4.min.css'%}">
  <link rel="stylesheet" href="{% static 'plugins/datatables-buttons/css/buttons.bootstrap4.min.css'%}">
  <!-- Theme style -->
  <link rel="stylesheet" href="{% static 'css/adminlte.css' %}">
  
</head>
<!--
`body` tag options:

  Apply one or more of the following classes to to the body tag
  to get the desired effect

  * sidebar-collapse
  * sidebar-mini
-->
<body class="hold-transition sidebar-mini">
<div class="wrapper">
  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="index3.html" class="nav-link">Home</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="#" class="nav-link">Contact</a>
      </li>
    </ul>

    <!-- Right navbar links -->
    <ul class="navbar-nav ml-auto">
      <li class="nav-item">
        <a class="nav-link" data-widget="navbar-search" href="#" role="button">
          <i class="fas fa-search"></i>
        </a>
        <div class="navbar-search-block">
          <form class="form-inline">
            <div class="input-group input-group-sm">
              <input class="form-control form-control-navbar" type="search" placeholder="Search" aria-label="Search">
              <div class="input-group-append">
                <button class="btn btn-navbar" type="submit">
                  <i class="fas fa-search"></i>
                </button>
                <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                  <i class="fas fa-times"></i>
                </button>
              </div>
            </div>
          </form>
        </div>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-widget="fullscreen" href="#" role="button">
          <i class="fas fa-expand-arrows-alt"></i>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="{% url 'logout' %}" role="button">
          <i class="fas fa-sign-out-alt"></i> Logout
        </a>
      </li>
    </ul>
  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="/owner/home" class="brand-link">
      <img src="{% static 'img/eglogo.png' %}" alt="AdminLTE Logo" class="brand-image img-circle elevation-3" style="opacity: .8">
      <span class="brand-text font-weight-light">Evergreen</span>
    </a>

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Sidebar user panel (optional) -->
      <div class="user-panel mt-3 pb-3 mb-3 d-flex">
        <div class="image">
          <img src="{% static 'img/jjb.png' %}" class="img-circle elevation-2" alt="User Image">
        </div>
        <div class="info">
          <a href="#" class="d-block">Jinesh Bhatewara</a>
        </div>
      </div>

      <!-- SidebarSearch Form -->
      {% comment %} <div class="form-inline">
        <div class="input-group" data-widget="sidebar-search">
          <input class="form-control form-control-sidebar" type="search" placeholder="Search" aria-label="Search">
          <div class="input-group-append">
            <button class="btn btn-sidebar">
              <i class="fas fa-search fa-fw"></i>
            </button>
          </div>
        </div>
      </div> {% endcomment %}

      <!-- Sidebar Menu -->
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
          <li class="nav-item">
            <a href="/owner/dashboard" class="nav-link ">
              <i class="nav-icon fas fa-tachometer-alt"></i>
              <p>
                Dashboard
                {% comment %} <span class="right badge badge-danger">New</span> {% endcomment %}
              </p>
            </a>
          </li>
          <li class="nav-item">
            <a href="/owner/customers" class="nav-link ">
              <i class="nav-icon fas fa-user "></i>
              <p>
                Customers
                {% comment %} <span class="right badge badge-danger">New</span> {% endcomment %}
              </p>
            </a>
          </li>
          <li class="nav-item">
            <a href="/owner/executives" class="nav-link active">
              <i class="nav-icon fas fa-walking "></i>
              <p>
                Executives
                {% comment %} <span class="right badge badge-danger">New</span> {% endcomment %}
              </p>
            </a>
          </li>
          <li class="nav-item">
            <a href="/owner/call" class="nav-link">
              <i class="nav-icon fas fa-phone-alt"></i>
              <p>
                Call
                {% comment %} <span class="right badge badge-danger">New</span> {% endcomment %}
              </p>
            </a>
          </li>
          <li class="nav-item">
            <a href="/owner/jobs" class="nav-link">
              <i class="nav-icon fas fa-copy"></i>
              <p>
                Jobsheets
                {% comment %} <span class="right badge badge-danger">New</span> {% endcomment %}
              </p>
            </a>
          </li>
          <li class="nav-item">
            <a href="/owner/amc" class="nav-link">
              <i class="nav-icon fas fa-tools"></i>
              <p>
                AMC
                {% comment %} <span class="right badge badge-danger">New</span> {% endcomment %}
              </p>
            </a>
          </li>

        </ul>
      </nav>
      <!-- /.sidebar-menu -->
    </div>
    <!-- /.sidebar -->
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0">Executives </h1>
          </div><!-- /.col -->
          <div class="col-sm-6">
            <ol class="breadcrumb float-sm-right">
              <li class="breadcrumb-item"><a href="#">Administrator</a></li>
              <li class="breadcrumb-item active">Executives </li>
            </ol>
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <div class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
            <!-- /.card -->

            <div class="card">
                <div class="card-header">
                <h3 class="card-title">Current Executives</h3>
                <button type="button" class="btn btn-success float-right" data-toggle="modal" data-target="#addExecutiveModal">
                  New Executive
                </button>

                <!-- Modal -->
                <div class="modal fade" id="addExecutiveModal" tabindex="-1" role="dialog" aria-labelledby="addExecutiveModalLabel" aria-hidden="true">
                  <div class="modal-dialog modal-lg" role="document">
                  <div class="modal-content">
                  <div class="modal-header">
                  <h5 class="modal-title" id="addExecutiveModalLabel">Add New Executive</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                  </div>
                  <form id="addExecutiveForm" method="POST" action="/owner/executives/add/" enctype="multipart/form-data">
                  {% csrf_token %}
                  <div class="modal-body">
                    <div class="form-row">
                    <div class="form-group col-md-4">
                    <label for="executiveName">Name*</label>
                    <input type="text" class="form-control" id="executiveName" name="name" placeholder="Name" required>
                    </div>
                    <div class="form-group col-md-4">
                    <label for="executiveContact">Contact Number*</label>
                    <input type="text" class="form-control" id="executiveContact" name="contact" placeholder="Contact" required>
                    </div>
                    <div class="form-group col-md-4">
                    <label for="executiveEmail">Email</label>
                    <input type="email" class="form-control" id="executiveEmail" name="email" placeholder="Email">
                    </div>
                    </div>
                    <div class="form-row">
                    <div class="form-group col-md-4">
                    <label for="executiveUsername">Username*</label>
                    <input type="text" class="form-control" id="executiveUsername" name="username" placeholder="Username" required>
                    </div>
                    <div class="form-group col-md-4">
                    <label for="executivePassword">Password*</label>
                    <input type="password" class="form-control" id="executivePassword" name="password" placeholder="Password" required>
                    </div>
                    <div class="form-group col-md-4">
                    <label for="executiveAltContact">Alternate Number</label>
                    <input type="text" class="form-control" id="executiveAltContact" name="alt_contact" placeholder="Alternate Number">
                    </div>
                    </div>
                    <div class="form-row">
                    <div class="form-group col-md-4">
                    <label for="executiveGender">Gender</label>
                    <select class="form-control" id="executiveGender" name="gender">
                    <option value="">Select Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                    </select>
                    </div>
                    <div class="form-group col-md-4">
                    <label for="executiveMaritalStatus">Marital Status</label>
                    <select class="form-control" id="executiveMaritalStatus" name="marital_status">
                    <option value="">Select Status</option>
                    <option value="Single">Single</option>
                    <option value="Married">Married</option>
                    </select>
                    </div>
                    <div class="form-group col-md-4">
                    <label for="executiveDOB">DOB*</label>
                    <input type="date" class="form-control" id="executiveDOB" name="dob" required>
                    </div>
                    </div>
                    <div class="form-row">
                    <div class="form-group col-md-4">
                    <label for="executiveDOJ">Date of Joining*</label>
                    <input type="date" class="form-control" id="executiveDOJ" name="doj" required>
                    </div>
                    <div class="form-group col-md-4">
                    <label for="executiveBloodGroup">Blood Group</label>
                    <select class="form-control" id="executiveBloodGroup" name="blood_group">
                    <option value="">Select Blood Group</option>
                    <option value="A+">A+</option>
                    <option value="A-">A-</option>
                    <option value="B+">B+</option>
                    <option value="B-">B-</option>
                    <option value="O+">O+</option>
                    <option value="O-">O-</option>
                    <option value="AB+">AB+</option>
                    <option value="AB-">AB-</option>
                    </select>
                    </div>
                    <div class="form-group col-md-4">
                    <label for="executiveDesignation">Designation*</label>
                    <select class="form-control" id="executiveDesignation" name="designation" required>
                    <option value="">Select Designation</option>
                    <option value="Manager">Manager</option>
                    <option value="Engineer">Engineer</option>
                    <option value="Technician">Technician</option>
                    <option value="Sales Executive">Sales Executive</option>
                    </select>
                    </div>
                    </div>
                    <div class="form-row">
                    <div class="form-group col-md-4">
                    <label for="executiveDepartment">Department*</label>
                    <select class="form-control" id="executiveDepartment" name="department" required>
                      <option value="">Select Department</option>
                      {% for department in departments %}
                      <option value="{{ department.id }}">{{ department.name }}</option>
                      {% endfor %}
                    </select>
                    </div>
                    <div class="form-group col-md-6">
                    <label for="executiveAddress">Address</label>
                    <input type="text" class="form-control" id="executiveAddress" name="address" placeholder="Address">
                    </div>
                    </div>
                    <div class="form-row">
                    <div class="form-group col-md-2">
                    <label for="executiveArea">Area</label>
                    <input type="text" class="form-control" id="executiveArea" name="area" placeholder="Area">
                    </div>
                    <div class="form-group col-md-2">
                    <label for="executiveCity">City</label>
                    <input type="text" class="form-control" id="executiveCity" name="city" placeholder="City">
                    </div>
                    <div class="form-group col-md-2">
                    <label for="executiveState">State</label>
                    <input type="text" class="form-control" id="executiveState" name="state" placeholder="State">
                    </div>
                    <div class="form-group col-md-2">
                    <label for="executiveCountry">Country</label>
                    <input type="text" class="form-control" id="executiveCountry" name="country" placeholder="Country">
                    </div>
                    <div class="form-group col-md-2">
                    <label for="executiveZip">Zip Code</label>
                    <input type="text" class="form-control" id="executiveZip" name="zip" placeholder="Zip Code">
                    </div>
                    </div>
                    <div class="form-row">
                    <div class="form-group col-md-4">
                    <label for="executiveMapUrl">Google Map Url</label>
                    <input type="text" class="form-control" id="executiveMapUrl" name="map_url" placeholder="Google Map Url">
                    </div>
                    <div class="form-group col-md-4">
                    <label for="executiveNotes">Notes</label>
                    <textarea class="form-control" id="executiveNotes" name="notes" placeholder="Notes"></textarea>
                    </div>
                    </div>
                    <div class="form-row">
                    <div class="form-group col-md-3">
                    <label for="executivePhoto">Photograph</label>
                    <input type="file" class="form-control-file" id="executivePhoto" name="photo">
                    </div>
                    <div class="form-group col-md-3">
                    <label for="executiveAadhar">Aadhar Card</label>
                    <input type="file" class="form-control-file" id="executiveAadhar" name="aadhar">
                    </div>
                    <div class="form-group col-md-3">
                    <label for="executivePan">Pan Card</label>
                    <input type="file" class="form-control-file" id="executivePan" name="pan">
                    </div>
                    <div class="form-group col-md-3">
                    <label for="executiveDL">Driving Licence</label>
                    <input type="file" class="form-control-file" id="executiveDL" name="driving_licence">
                    </div>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Submit</button>
                  </div>
                  </form>
                  </div>
                  </div>
                </div>
                </div>
              <!-- /.card-header -->
              <div class="card-body">
                <table id="example1" class="table table-bordered table-striped">
                    <thead>
                    <tr>
                    <th>Name</th>
                    <th>Department</th>
                    <th>Contact</th>
                    <th>Action</th>
                    <th>Note</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for executive in executives %}
                    <tr>
                    <td>{{ executive.first_name }}</td>
                    <td>{{ executive.department__name }}</td>
                    <td>{{ executive.contact_number }}</td>
                    <td>
                      <a class="btn btn-info btn-sm view-button" data-id="{{ executive.id }}" href="javascript:void(0);">
                        <i class="fas fa-edit"></i>
                      </a>
                      <a class="btn btn-danger btn-sm delete-button" data-id="{{ executive.id }}" href="javascript:void(0);">
                        <i class="fas fa-trash"></i></a>
                        <!-- View Executive Modal -->
                        <div class="modal fade" id="viewExecutiveModal" tabindex="-1" role="dialog" aria-labelledby="viewExecutiveModalLabel" aria-hidden="true">
                          <div class="modal-dialog modal-lg" role="document">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="viewExecutiveModalLabel">Executive Details</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                  <span aria-hidden="true">&times;</span>
                                </button>
                              </div>
                              <div class="modal-body">
                                <div id="executiveDetails">
                                  
                                  <!-- Details will be dynamically loaded here -->
                                </div>
                              </div>
                              <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                              </div>
                            </div>
                          </div>
                        </div>


                    </td>
                    <td>{{ executive.notes }}</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                  {% comment %} <tfoot>
                  <tr>
                    <th>Rendering engine</th>
                    <th>Browser</th>
                    <th>Platform(s)</th>
                    <th>Engine version</th>
                    <th>CSS grade</th>
                  </tr>
                  </tfoot> {% endcomment %}
                </table>
              </div>
              <!-- /.card-body -->
            </div>
            <!-- /.card -->
          </div>
          <!-- /.col -->
        </div>

      </div>
      <!-- /.container-fluid -->
    </div>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->

  <!-- Main Footer -->
  <footer class="main-footer">
    <strong>Copyright &copy; 2025-2026 <span style="color: #ff5733; font-style: italic; font-weight: bold;">Jinesh</span>.</strong>
    All rights reserved.
    <div class="float-right d-none d-sm-inline-block">
      <b>Version</b> 1.0.0
    </div>
  </footer>
</div>
<!-- ./wrapper -->

<!-- REQUIRED SCRIPTS -->

<!-- jQuery -->
<script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>

<!-- Bootstrap -->
<script src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>

<script src= "{% static 'plugins/datatables/jquery.dataTables.min.js' %}"></script>
<script src= "{% static 'plugins/datatables-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
<script src= "{% static 'plugins/datatables-responsive/js/dataTables.responsive.min.js' %}"></script>
<script src= "{% static 'plugins/datatables-responsive/js/responsive.bootstrap4.min.js' %}"></script>
<script src= "{% static 'plugins/datatables-buttons/js/dataTables.buttons.min.js' %}"></script>
<script src= "{% static 'plugins/datatables-buttons/js/buttons.bootstrap4.min.js' %}"></script>
<script src= "{% static 'plugins/jszip/jszip.min.js' %}"></script>
<script src= "{% static 'plugins/pdfmake/pdfmake.min.js' %}"></script>
<script src= "{% static 'plugins/pdfmake/vfs_fonts.js' %}"></script>
<script src= "{% static 'plugins/datatables-buttons/js/buttons.html5.min.js' %}"></script>
<script src= "{% static 'plugins/datatables-buttons/js/buttons.print.min.js' %}"></script>
<script src= "{% static 'plugins/datatables-buttons/js/buttons.colVis.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
  $(document).on('click', '.delete-button', function () {
    const executiveId = $(this).data('id'); // Get the executive ID from the button

    // Show SweetAlert confirmation dialog
    Swal.fire({
      title: 'Are you sure?',
      text: "You won't be able to revert this!",
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
      if (result.isConfirmed) {
        // Show loading spinner
        Swal.fire({
          title: 'Deleting...',
          text: 'Please wait while we delete the executive.',
          allowOutsideClick: false,
          didOpen: () => {
            Swal.showLoading();
          }
        });

        // Send AJAX request to delete the executive
        $.ajax({
          url: `/owner/executives/delete/${executiveId}/`,
          type: 'DELETE',
          headers: {
            'X-CSRFToken': '{{ csrf_token }}' // Include CSRF token
          },
          success: function (response) {
            if (response.status === 'success') {
              Swal.fire(
                'Deleted!',
                response.message,
                'success'
              ).then(() => {
                location.reload(); // Reload the page to update the table
              });
            } else {
              Swal.fire(
                'Error!',
                response.message,
                'error'
              );
            }
          },
          error: function () {
            Swal.fire(
              'Error!',
              'An error occurred while deleting the executive.',
              'error'
            );
          }
        });
      }
    });
  });
</script>

<script>
  $(document).on('click', '.view-button', function () {
    const executiveId = $(this).data('id'); // Get the executive ID from the button

    // Show loading spinner
    Swal.fire({
      title: 'Loading Details...',
      allowOutsideClick: false,
      didOpen: () => {
        Swal.showLoading();
      }
    });

    // Fetch executive details via AJAX
    $.ajax({
      url: `/owner/executives/details/${executiveId}/`,
      type: 'GET',
      success: function (response) {
        if (response.status === 'success') {
          Swal.close(); // Close the loading spinner
          $('#executiveDetails').html(response.html); // Populate modal with details
          $('#viewExecutiveModal').modal('show'); // Show the modal
        } else {
          Swal.fire(
            'Error!',
            response.message,
            'error'
          );
        }
      },
      error: function () {
        Swal.fire(
          'Error!',
          'An error occurred while fetching the executive details.',
          'error'
        );
      }
    });
  });
</script>
<script>
  $(document).ready(function () {
    $('#addExecutiveForm').on('submit', function (e) {
      e.preventDefault(); // Prevent default form submission

      // Show loading spinner
      Swal.fire({
        title: 'Adding Executive...',
        text: 'Please wait while we process your request.',
        allowOutsideClick: false,
        didOpen: () => {
          Swal.showLoading();
        }
      });

      // Send AJAX request
      $.ajax({
        url: "{% url 'add_executive' %}",
        type: "POST",
        data: new FormData(this),
        processData: false,
        contentType: false,
        success: function (response) {
          if (response.status === 'success') {
            // Show success message
            Swal.fire({
              title: 'Success!',
              text: response.message,
              icon: 'success',
              confirmButtonText: 'OK'
            }).then(() => {
              location.reload(); // Reload the page to update the table
            });
          } else {
            // Show error message
            Swal.fire({
              title: 'Error!',
              text: response.message,
              icon: 'error',
              confirmButtonText: 'OK'
            });
          }
        },
        error: function () {
          // Show generic error message
          Swal.fire({
            title: 'Error!',
            text: 'An error occurred while adding the executive.',
            icon: 'error',
            confirmButtonText: 'OK'
          });
        }
      });
    });
  });
</script>
<!-- AdminLTE -->
<script src="{% static 'js/adminlte.js' %}"></script>

<!-- OPTIONAL SCRIPTS -->

<!-- AdminLTE dashboard demo (This is only for demo purposes) -->
<script src="{% static 'js/pages/dashboard3.js' %}"></script>
<script>
  $(function () {
    $("#example1").DataTable({
      "responsive": true, "lengthChange": false, "autoWidth": false,
      "buttons": ["copy", "csv", "pdf", "print", "colvis"]
    }).buttons().container().appendTo('#example1_wrapper .col-md-6:eq(0)');
    $('#example2').DataTable({
      "paging": true,
      "lengthChange": false,
      "searching": false,
      "ordering": true,
      "info": true,
      "autoWidth": false,
      "responsive": true,
    });
  });
</script>
</body>
</html>

